var e=Object.defineProperty,t=(t,a,r)=>(((t,a,r)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r})(t,"symbol"!=typeof a?a+"":a,r),r);export function __vite_legacy_guard(){import("data:text/javascript,")}import{d as a,r,o as n,w as s,c as i,a as o,t as l,b as u,n as d,P as c,e as p,u as v,f,g,h as m,i as y,F as b,j as h,k as S,l as j,m as w,p as P,L as U,q as k,s as L,v as N,x as O,y as q}from"./vendor.7692c8f1.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var x=a({props:{source:{type:String,default:""}},setup(e){const t=e,a=r(null);return n((()=>{s((()=>(d((()=>{c.highlightElement(a.value)})),t.source)))})),(e,r)=>(u(),i("pre",null,[o("code",{ref:(e,t)=>{t.code=e,a.value=e},class:"language-javascript"},l(t.source),513)]))}});function A(e,t){const a={};for(const r in e)a[r]=p({get:()=>e[r],set(e){t(`update:${r}`,e)}});return a}const D=["data-gutter"];var B=a({props:{inside:{type:String,default:"inside",required:!0},source:{type:String,default:""},title:{type:String,default:""},preamble:{type:String,default:""},version:{type:String,default:"16.6.0"}},emits:["update:inside","update:source","update:title","update:preamble","update:version","update:loading"],setup(e,{emit:t}){const a=e,{inside:l,source:d,title:c,preamble:f,version:g}=A(a,t),m=r(null),y=p({get:()=>g.value.trim().split(".").map(((e,t)=>0===t?e:"x")).join("."),set(e){g.value=e}});return t("update:loading",!0),n((async()=>{const e=window.RunKit.createNotebook({element:m.value,preamble:f.value,title:c.value,gutterStyle:l.value,source:d.value,nodeVersion:y.value});e.onLoad=async a=>{t("update:loading",!1),e.evaluate()},e.onSave=async()=>{e.getSource().then((e=>d.value=e)),e.getNodeVersion().then((e=>y.value=e))},s((()=>e.setSource(d.value))),s((()=>e.setTitle(c.value))),s((()=>e.setPreamble(f.value))),s((()=>e.setNodeVersion(y.value)))})),(e,t)=>(u(),i("pre",{class:"embed","data-gutter":v(l)},[o("div",{ref:(e,t)=>{t.element=e,m.value=e}},null,512)],8,D))}}),E=a({props:{inside:{type:String,default:"inside",required:!0},source:{type:String,default:""},title:{type:String,default:""},preamble:{type:String,default:""},version:{type:String,default:"16.6.0"}},emits:["update:inside","update:source","update:title","update:preamble","update:version"],setup(e,{emit:t}){const a=e,{inside:n,source:s,title:o,preamble:l,version:d}=A(a,t),c=r(!0);return(e,t)=>(u(),i(b,null,[c.value?(u(),f(x,{key:0,source:v(s)},null,8,["source"])):g("",!0),m(B,{source:v(s),"onUpdate:source":t[0]||(t[0]=e=>y(s)?s.value=e:null),inside:v(n),"onUpdate:inside":t[1]||(t[1]=e=>y(n)?n.value=e:null),title:v(o),"onUpdate:title":t[2]||(t[2]=e=>y(o)?o.value=e:null),preamble:v(l),"onUpdate:preamble":t[3]||(t[3]=e=>y(l)?l.value=e:null),version:v(d),"onUpdate:version":t[4]||(t[4]=e=>y(d)?d.value=e:null),"onUpdate:loading":t[5]||(t[5]=e=>c.value=e)},null,8,["source","inside","title","preamble","version"])],64))}});class F{constructor(){t(this,"pending",!1),t(this,"fulfilled",!1),t(this,"rejected",!1),t(this,"data",{}),t(this,"error",{}),t(this,"p",Promise.resolve())}setP(e){this.p=e}equalP(e){return this.p===e}reLoad(){}}const J=r(new Date);setInterval((()=>{J.value=new Date}),100);const _={key:0,style:{position:"absolute","background-color":"aliceblue",padding:"4px 6px"}};const T=q(a({setup(e){O.apiCache=!0;const t=h({source:"",inside:"inside",title:"",preamble:"",version:"16.6.0"}),a=function({deps:e,getter:t,dataMergeFun:a=((e,t)=>t),defaultData:r}){const n=new F;return void 0!==r&&(n.data=r),S(((r,i)=>{if(e){if(e)if(e instanceof Function){const a=e();Array.isArray(a)&&0===a.length||j(e,(()=>o(t())),{immediate:!0})}else j(e,(()=>o(t())),{immediate:!0})}else s((()=>o(t())));function o(e){n.setP(e),n.pending=!0,n.fulfilled=!1,n.rejected=!1,d(i),e.then((t=>{n.equalP(e)&&(n.pending=!1,n.fulfilled=!0,n.data=a(n.data,t))})).catch((t=>{n.equalP(e)&&(n.pending=!1,n.rejected=!0,n.error=t)})).finally((()=>{n.equalP(e)&&i()}))}return n.reLoad=()=>{o(t())},{get:()=>(r(),n),set(e){console.warn("不可设置值")}}}))}({deps:()=>[],getter:()=>k.setBlockAttrs({id:P(),attrs:{"custom-config":JSON.stringify(t)}})}),n=r(Date.now());s((()=>{a.value,n.value=Date.now()+3e3}));const o=p((()=>!!a.value.pending||!(!a.value.fulfilled&&!a.value.rejected)&&n.value>J.value.getTime()));return w((async()=>{const e=P(),[r,n]=function(e=document.location.toString(),t){const a=new URL(e),r=a.searchParams,n=h(t);r.forEach(((e,t)=>{try{n[t]=atob(e)}catch(a){n[t]=e}}));const s=p((()=>(Object.keys(n).forEach((e=>{const t=btoa(n[e]||"");r.set(e,t)})),a.href)));return[n,s]}(void 0,{code:"{}"});s((()=>history.replaceState("","",n.value))),Object.assign(t,JSON.parse(U.decompressFromBase64(r.code)||"{}")),s((()=>{r.code=U.compressToBase64(JSON.stringify(t))})),e?(await k.getBlockAttr(e,"custom-config").then((e=>{if(e){const a=L(e.value);a?Object.assign(t,JSON.parse(a)):console.error("decode 失败, code:",e.value)}})),N()===N.env.siYuan&&j(t,(()=>a.value.reLoad()))):console.error("获取当前挂件快id失败，不再尝试调用思源 api 保存代码")})),(e,r)=>(u(),i(b,null,[v(o)?(u(),i("div",_,l(v(a).pending?"保存中":v(a).fulfilled?"保存成功":v(a).rejected?"保存失败":""),1)):g("",!0),m(E,{source:v(t).source,"onUpdate:source":r[0]||(r[0]=e=>v(t).source=e),inside:v(t).inside,"onUpdate:inside":r[1]||(r[1]=e=>v(t).inside=e),title:v(t).title,"onUpdate:title":r[2]||(r[2]=e=>v(t).title=e),preamble:v(t).preamble,"onUpdate:preamble":r[3]||(r[3]=e=>v(t).preamble=e),version:v(t).version,"onUpdate:version":r[4]||(r[4]=e=>v(t).version=e)},null,8,["source","inside","title","preamble","version"])],64))}}));T.mount("#app"),T.config;
//# sourceMappingURL=index.7f277c1d.js.map
