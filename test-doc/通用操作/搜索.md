## 搜索功能

搜索主要涉及三个功能点：

* 全局文本搜索，通过 <kbd>Ctrl P</kbd> / <kbd>⌘ P</kbd> 触发搜索框
* 内容块引用/嵌入搜索，在编辑器文档时通过输入 `((关键字` 触发
* 关系图搜索，在关系图中根据关键字筛选过滤节点和连接

## 类型过滤

搜索关键字如果以如下字符开头，则启用类型过滤。

* `d` 文档块
* `#` 标题块
* `*` 列表块（包含有序列表块、无序列表块和任务列表块）
* `-` 列表项块
* `` ` `` 代码块
* `>` 块引用块
* `$` 数学公式块
* `{` 超级块
* `p` 段落块

比如想要搜索所有包含 `Markdown` 的标题块，则可以使用 `#Markdown` 作为搜索条件。

## 给极客准备的...
{: id="20201117103851-l9cahuc"}

全局文本搜索支持：

* 正则表达式
* SQL

对于 SQL 搜索，使用内置 SQLite 数据库（系统临时文件夹/siyuan/siyuan.db）实现。

* 编辑变更会自动同步到该数据库，请勿对该数据库进行写入操作
* 该数据库临时创建，只在内核运行时存在
* 数据是编辑文档后 7 秒异步写入的，并不是实时写入

### `blocks` 表

该表用于存储内容块数据。

|   字段 | 类型 | 说明                                      |
| -------: | :-----: | ------------------------------------------- |
|       id | integer | 自增主键                                |
| block_id |  text  | 内容块 ID                                |
|      box |  text  | 笔记本名                                |
|     path |  text  | 内容块所在文档路径                 |
|  tree_id |  text  | 抽象语法树 ID，和根节点 ID 相同 |
|  content |  text  | 内容块 Markdown                          |
|     type |  text  | 内容块类型                             |

示例：

```sql
SELECT * FROM blocks WHERE content LIKE '%内容块%'
```

`type` 内容块类型值列表：

* `NodeDocument` 文档块
* `NodeHeading` 标题块
* `NodeParagraph` 段落块
* `NodeList` 列表块
* `NodeListItem` 列表项块
* `NodeMathBlock` 数学公式块
* `NodeCodeBlock` 代码块
* `NodeBlockquote` 块引用块
* `NodeTable` 表格块
* `NodeSuperBlock` 超级块

### 默认查询条件

* 如果不指定 `type` 列，则默认会加上 `type = NodeParagraph`，即只查询段落块
* 如果不指定 `LIMIT`，则最多只返回前 32 条结果


{: id="20200813091734-6depm11" type="doc"}
