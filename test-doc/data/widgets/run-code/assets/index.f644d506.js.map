{"version":3,"file":"index.f644d506.js","sources":["../../src/components/run-code.vue","../../src/components/props-to-refs.ts","../../src/main.ts","../../src/App.vue"],"sourcesContent":["<template>\r\n  <pre class=\"embed\" :data-gutter=\"inside\"><div ref=\"element\"></div> </pre>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { ref, onMounted, watchEffect, computed, toRefs } from \"vue\";\r\nimport type { PropType } from \"vue\";\r\nimport { propsToRefs } from \"./props-to-refs\";\r\nconst props = defineProps({\r\n  inside: {\r\n    type: String as PropType<EmbedOptions[\"gutterStyle\"]>,\r\n    default: \"inside\",\r\n    required: true,\r\n  },\r\n  source: {\r\n    type: String,\r\n    default: \"\",\r\n  },\r\n  title: {\r\n    type: String,\r\n    default: \"\",\r\n  },\r\n  preamble: {\r\n    type: String,\r\n    default: \"\",\r\n  },\r\n  version: {\r\n    type: String,\r\n    default: \"16.6.0\",\r\n  },\r\n});\r\nconst emit = defineEmits([\r\n  \"update:inside\",\r\n  \"update:source\",\r\n  \"update:title\",\r\n  \"update:preamble\",\r\n  \"update:version\",\r\n]);\r\nconst { inside, source, title, preamble, version } = propsToRefs(props, emit);\r\nconst element = ref<HTMLElement | null>(null);\r\nconst nodeVersion = computed({\r\n  get() {\r\n    //   run-kit 的 setNodeVersion 似乎只接受这种形式的输入\r\n    return version!\r\n      .value!.trim()\r\n      .split(\".\")\r\n      .map((v, index) => {\r\n        if (index === 0) {\r\n          return v;\r\n        } else {\r\n          return \"x\";\r\n        }\r\n      })\r\n      .join(\".\");\r\n  },\r\n  set(v: string) {\r\n    version!.value = v;\r\n  },\r\n});\r\nonMounted(async () => {\r\n  const cell = window.RunKit.createNotebook({\r\n    element: element.value! as HTMLElement,\r\n    preamble: preamble!.value,\r\n    title: title!.value,\r\n    gutterStyle: inside.value,\r\n    source: source!.value,\r\n    nodeVersion: nodeVersion.value,\r\n  });\r\n\r\n  cell.onLoad = async (book) => {\r\n    cell.evaluate();\r\n  };\r\n\r\n  // 各种属性的绑定\r\n  cell.onSave = async () => {\r\n    cell.getSource().then((v) => (source!.value = v));\r\n    cell.getNodeVersion().then((v) => (nodeVersion.value = v));\r\n  };\r\n  watchEffect(() => cell.setSource(source!.value!));\r\n  watchEffect(() => cell.setTitle(title!.value!));\r\n  watchEffect(() => cell.setPreamble(preamble!.value!));\r\n  watchEffect(() => cell.setNodeVersion(nodeVersion.value));\r\n});\r\n</script>\r\n","import type { ToRefs } from \"vue\";\r\nimport { computed } from \"vue\";\r\nexport function propsToRefs<T extends object>(props: T, emit: (event: any, ...args: any[]) => void): ToRefs<T> {\r\n  const ret: any = {};\r\n  for (const key in props) {\r\n    // ret[key] = toRef(props, key);\r\n    ret[key] = computed({\r\n      get() {\r\n        return props[key];\r\n      },\r\n      set(v) {\r\n        emit(`update:${key}`, v);\r\n      },\r\n    });\r\n  }\r\n  return ret;\r\n}\r\n","import { createApp } from 'vue'\nimport App from './App.vue'\n\nconst app = createApp(App)\napp.mount('#app')\napp.config\n\n\n","<template>\n  <runCodeVue\n    v-model:source=\"config.source\"\n    v-model:inside=\"config.inside\"\n    v-model:title=\"config.title\"\n    v-model:preamble=\"config.preamble\"\n    v-model:version=\"config.version\"\n  />\n</template>\n\n<script lang=\"ts\" setup>\nimport runCodeVue from \"./components/run-code.vue\";\nimport { reactive, onBeforeMount, watchEffect } from \"vue\";\n\nimport { api, util, config as apiConfig } from \"siyuan_api_cache_lib\";\n\n// 非开发模式下不用设定 server，使用相对路径来指向 思源server\nif (import.meta.env.DEV) {\n  apiConfig.server = \"http://127.0.0.1:6806\";\n}\napiConfig.apiCache = true;\nconst config = reactive({\n  source: \"\",\n  inside: \"inside\" as const,\n  title: \"\",\n  preamble: \"\",\n  version: \"16.6.0\",\n});\n\nonBeforeMount(async () => {\n  const id = util.currentNodeId();\n  // 从本地获取 config 的值\n  if (id) {\n    api\n      .getBlockAttr(id, \"custom-config\")\n      .then((r) => {\n        if (r) {\n          const source = util.htmlDecode(r.value);\n          if (source) {\n            Object.assign(config, JSON.parse(source));\n          } else {\n            console.error(\"decode 失败, code:\", r.value);\n          }\n        }\n        // 没有找到配置项，啥也不做\n      })\n      .catch((e) => {\n        console.error(\"查询config失败\", e);\n      });\n  } else {\n    console.error(\"获取当前挂件快id失败\");\n  }\n  // 保存 config 到本地\n  if (util.getCurrentEnv() === util.getCurrentEnv.env.siYuan) {\n    watchEffect(() => {\n      api\n        .setBlockAttrs({\n          id: util.currentNodeId()!,\n          attrs: { \"custom-config\": JSON.stringify(config) },\n        })\n        .then((r) => {\n          // console.log(\"保存成功\", r);\n        });\n    });\n  }\n});\n</script>\n"],"names":["inside","source","title","preamble","version","props","emit","ret","key","computed","get","set","v","propsToRefs","element","ref","nodeVersion","value","trim","split","map","index","join","async","cell","window","RunKit","createNotebook","gutterStyle","onLoad","book","evaluate","onSave","getSource","then","getNodeVersion","setSource","setTitle","setPreamble","setNodeVersion","app","createApp","apiCache","config","reactive","id","util.currentNodeId","getBlockAttr","r","util.htmlDecode","assign","JSON","parse","error","catch","e","util.getCurrentEnv","env","siYuan","setBlockAttrs","attrs","stringify","mount"],"mappings":"yhBAsCMA,OAAEA,SAAQC,QAAQC,WAAOC,UAAUC,YCpCKC,EAAUC,SAChDC,EAAW,aACNC,KAAOH,IAEZG,GAAOC,EAAS,CAClBC,QACSL,EAAMG,GAEfG,IAAIC,KACG,UAAUJ,IAAOI,aAIrBL,EDuB4CM,CAAYR,EAAOC,GAClEQ,EAAUC,EAAwB,MAClCC,EAAcP,EAAS,CAC3BC,QAESN,EACJa,MAAOC,OACPC,MAAM,KACNC,KAAI,CAACR,EAAGS,IACO,IAAVA,EACKT,EAEA,MAGVU,KAAK,KAEVX,IAAIC,KACOK,MAAQL,eAGXW,gBACFC,EAAOC,OAAOC,OAAOC,eAAe,CACxCb,QAASA,EAAQG,MACjBd,SAAUA,EAAUc,MACpBf,MAAOA,EAAOe,MACdW,YAAa5B,EAAOiB,MACpBhB,OAAQA,EAAQgB,MAChBD,YAAaA,EAAYC,UAGtBY,OAASN,MAAOO,MACdC,cAIFC,OAAST,YACPU,YAAYC,MAAMtB,GAAOX,EAAQgB,MAAQL,MACzCuB,iBAAiBD,MAAMtB,GAAOI,EAAYC,MAAQL,QAE7C,IAAMY,EAAKY,UAAUnC,EAAQgB,YAC7B,IAAMO,EAAKa,SAASnC,EAAOe,YAC3B,IAAMO,EAAKc,YAAYnC,EAAUc,YACjC,IAAMO,EAAKe,eAAevB,EAAYC,wHE9EpD,MAAMuB,EAAMC,gBCiBFC,UAAW,QACfC,EAASC,EAAS,CACtB3C,OAAQ,GACRD,OAAQ,SACRE,MAAO,GACPC,SAAU,GACVC,QAAS,qBAGGmB,gBACNsB,EAAKC,IAEPD,IAECE,aAAaF,EAAI,iBACjBX,MAAMc,OACDA,EAAG,OACC/C,EAASgD,EAAgBD,EAAE/B,OAC7BhB,SACKiD,OAAOP,EAAQQ,KAAKC,MAAMnD,YAEzBoD,MAAM,mBAAoBL,EAAE/B,WAKzCqC,OAAOC,YACEF,MAAM,aAAcE,cAGxBF,MAAM,eAGZG,MAAyBA,EAAmBC,IAAIC,WACtC,OAEPC,cAAc,CACbd,GAAIC,IACJc,MAAO,CAAE,gBAAiBT,KAAKU,UAAUlB,MAE1CT,MAAMc,qbDxDfR,EAAIsB,MAAM,QACVtB,EAAIG"}